<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jeu Avion 2D - Desktop</title>
    <style>
        body { margin: 0; background: linear-gradient(180deg, #87CEEB 0%, #98FB98 100%); display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; font-family: Arial, sans-serif; }
        #sky { position: relative; width: 600px; height: 100vh; background: linear-gradient(180deg, #1e3c72 0%, #2a5298 50%, #87CEEB 100%); border: 3px solid #333; overflow: hidden; }
        #plane { position: absolute; width: 60px; height: 40px; bottom: 100px; left: 50%; transform: translateX(-50%); transition: left 0.1s linear; font-size: 30px; z-index: 10; }
        .projectile { position: absolute; width: 4px; height: 20px; background-color: #ffff00; border-radius: 50%; animation: shoot 2s linear forwards; z-index: 5; }
        @keyframes shoot { from { bottom: 140px; } to { bottom: 100vh; opacity: 0; } }
        .cloud { position: absolute; background: rgba(255,255,255,0.8); border-radius: 50px; animation: float 15s linear infinite; }
        .cloud1 { width: 80px; height: 40px; top: 20%; left: -100px; }
        .cloud2 { width: 100px; height: 50px; top: 40%; left: -120px; animation-delay: -5s; }
        .cloud3 { width: 60px; height: 30px; top: 60%; left: -80px; animation-delay: -10s; }
        @keyframes float { from { left: -120px; } to { left: 100vw; } }
        #score { position: absolute; top: 20px; left: 20px; color: white; font-size: 18px; z-index: 15; }
        #controls-info { position: absolute; bottom: 20px; left: 20px; color: white; font-size: 14px; z-index: 15; }
    </style>
</head>
<body>
    <div id="sky">
        <div id="plane">‚úàÔ∏è</div>
        <div class="cloud cloud1"></div>
        <div class="cloud cloud2"></div>
        <div class="cloud cloud3"></div>
        <div id="score">Score: 0</div>
        <div id="controls-info">
            üì± Utilisez votre t√©l√©phone pour contr√¥ler l'avion<br>
            ‚Üê ‚Üí Tourner | ‚úàÔ∏è Acc√©l√©rer | üí• Tirer
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const plane = document.getElementById('plane');
        const sky = document.getElementById('sky');
        const scoreElement = document.getElementById('score');
        
        let planePosition = sky.offsetWidth / 2;
        let score = 0;
        let projectileCount = 0;

        plane.style.left = `${planePosition}px`;

        // Handle plane movement from mobile
        socket.on('update', (data) => {
            console.log('Donn√©es re√ßues:', data);
            
            if (data.action === 'move') {
                if (data.direction === 'left') {
                    planePosition -= 20;
                    plane.style.transform = 'translateX(-50%) rotate(-10deg)';
                } else if (data.direction === 'right') {
                    planePosition += 20;
                    plane.style.transform = 'translateX(-50%) rotate(10deg)';
                }
                
                // Keep plane within bounds
                const planeWidth = plane.offsetWidth;
                planePosition = Math.max(planeWidth / 2, Math.min(sky.offsetWidth - planeWidth / 2, planePosition));
                plane.style.left = `${planePosition}px`;
                
                // Reset rotation after movement
                setTimeout(() => {
                    plane.style.transform = 'translateX(-50%) rotate(0deg)';
                }, 200);
                
            } else if (data.action === 'accelerate') {
                // Visual acceleration effect
                plane.style.transform = 'translateX(-50%) scale(1.2)';
                setTimeout(() => {
                    plane.style.transform = 'translateX(-50%) scale(1)';
                }, 150);
            }
        });

        // Handle shooting from mobile
        socket.on('shoot-projectile', () => {
            createProjectile();
        });

        function createProjectile() {
            const projectile = document.createElement('div');
            projectile.className = 'projectile';
            projectile.style.left = `${planePosition}px`;
            projectile.style.bottom = '140px';
            
            sky.appendChild(projectile);
            projectileCount++;
            
            console.log(`Projectile cr√©√© #${projectileCount} √† la position ${planePosition}px`);
            
            // Update score
            score += 10;
            scoreElement.textContent = `Score: ${score} | Tirs: ${projectileCount}`;
            
            // Remove projectile after animation
            setTimeout(() => {
                if (projectile.parentNode) {
                    projectile.parentNode.removeChild(projectile);
                }
            }, 2000);
            
            // Add explosion effect at plane position
            const explosion = document.createElement('div');
            explosion.style.position = 'absolute';
            explosion.style.left = `${planePosition}px`;
            explosion.style.bottom = '140px';
            explosion.style.transform = 'translateX(-50%)';
            explosion.style.fontSize = '20px';
            explosion.textContent = 'üí•';
            explosion.style.zIndex = '20';
            
            sky.appendChild(explosion);
            setTimeout(() => {
                if (explosion.parentNode) {
                    explosion.parentNode.removeChild(explosion);
                }
            }, 300);
        }

        // Connection status
        socket.on('connect', () => {
            console.log('‚úàÔ∏è Avion connect√© au contr√¥le');
        });

        socket.on('disconnect', () => {
            console.log('üö´ Avion d√©connect√© du contr√¥le');
        });
    </script>
</body>
</html>