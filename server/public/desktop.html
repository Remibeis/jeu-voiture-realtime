<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jeu Avion 2D - Desktop</title>
    <style>
        body { margin: 0; background: linear-gradient(180deg, #87CEEB 0%, #98FB98 100%); display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; font-family: Arial, sans-serif; }
        #sky { position: relative; width: 600px; height: 100vh; background: linear-gradient(180deg, #1e3c72 0%, #2a5298 50%, #87CEEB 100%); border: 3px solid #333; overflow: hidden; }
        #plane { position: absolute; width: 60px; height: 40px; bottom: 100px; left: 50%; transform: translateX(-50%); transition: left 0.1s linear; z-index: 10; }
        #plane img { width: 100%; height: 100%; object-fit: contain; }
        .projectile { position: absolute; width: 4px; height: 20px; background-color: #ffff00; border-radius: 50%; animation: shoot 2s linear forwards; z-index: 5; }
        @keyframes shoot { from { bottom: 140px; } to { bottom: 100vh; opacity: 0; } }
        @keyframes flicker { 
            0% { opacity: 1; transform: scaleX(1); }
            100% { opacity: 0.7; transform: scaleX(1.2); }
        }
        .cloud { position: absolute; background: rgba(255,255,255,0.8); border-radius: 50px; animation: float 15s linear infinite; }
        .cloud1 { width: 80px; height: 40px; top: 20%; left: -100px; }
        .cloud2 { width: 100px; height: 50px; top: 40%; left: -120px; animation-delay: -5s; }
        .cloud3 { width: 60px; height: 30px; top: 60%; left: -80px; animation-delay: -10s; }
        @keyframes float { from { left: -120px; } to { left: 100vw; } }
        #score { position: absolute; top: 20px; left: 20px; color: white; font-size: 18px; z-index: 15; }
        #controls-info { position: absolute; bottom: 20px; left: 20px; color: white; font-size: 14px; z-index: 15; }
    </style>
</head>
<body>
    <div id="sky">
        <div id="plane"><img src="fighter-jet.svg" alt="Fighter Jet" /></div>
        <div class="cloud cloud1"></div>
        <div class="cloud cloud2"></div>
        <div class="cloud cloud3"></div>
        <div id="score">Score: 0</div>
        <div id="controls-info">
            üì± Utilisez votre t√©l√©phone pour contr√¥ler l'avion<br>
            ‚Üê ‚Üí Tourner | ‚úàÔ∏è Acc√©l√©rer | üí• Tirer
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const plane = document.getElementById('plane');
        const sky = document.getElementById('sky');
        const scoreElement = document.getElementById('score');
        
        let planePosition = sky.offsetWidth / 2;
        let score = 0;
        let projectileCount = 0;

        plane.style.left = `${planePosition}px`;

        // Enhanced plane movement with smoother controls
        let currentRotation = 0;
        let isAccelerating = false;
        
        socket.on('update', (data) => {
            console.log('üéÆ Control received:', data);
            
            if (data.action === 'move') {
                if (data.direction === 'left') {
                    planePosition -= 12; // Smoother movement
                    currentRotation = -15;
                    plane.style.transform = `translateX(-50%) rotate(${currentRotation}deg) ${isAccelerating ? 'scale(1.1)' : ''}`;
                } else if (data.direction === 'right') {
                    planePosition += 12;
                    currentRotation = 15;
                    plane.style.transform = `translateX(-50%) rotate(${currentRotation}deg) ${isAccelerating ? 'scale(1.1)' : ''}`;
                }
                
                // Keep plane within bounds with buffer
                const planeWidth = plane.offsetWidth;
                const buffer = planeWidth / 2 + 10;
                planePosition = Math.max(buffer, Math.min(sky.offsetWidth - buffer, planePosition));
                plane.style.left = `${planePosition}px`;
                
                // Gradual rotation reset
                setTimeout(() => {
                    currentRotation *= 0.8; // Gradual return to center
                    if (Math.abs(currentRotation) < 1) currentRotation = 0;
                    plane.style.transform = `translateX(-50%) rotate(${currentRotation}deg) ${isAccelerating ? 'scale(1.1)' : ''}`;
                }, 100);
                
            } else if (data.action === 'accelerate') {
                // Enhanced acceleration effect with afterburner
                isAccelerating = true;
                plane.style.transform = `translateX(-50%) rotate(${currentRotation}deg) scale(1.2)`;
                
                // Add afterburner effect
                const afterburner = document.createElement('div');
                afterburner.style.cssText = `
                    position: absolute;
                    width: 20px; height: 8px;
                    background: linear-gradient(90deg, #ff4400, #ffaa00, transparent);
                    left: ${planePosition + 30}px;
                    bottom: 115px;
                    border-radius: 50%;
                    animation: flicker 0.1s infinite alternate;
                    z-index: 8;
                `;
                sky.appendChild(afterburner);
                
                setTimeout(() => {
                    isAccelerating = false;
                    plane.style.transform = `translateX(-50%) rotate(${currentRotation}deg) scale(1)`;
                    if (afterburner.parentNode) {
                        afterburner.parentNode.removeChild(afterburner);
                    }
                }, 300);
            }
        });

        // Handle shooting from mobile
        socket.on('shoot-projectile', () => {
            createProjectile();
        });

        function createProjectile() {
            // Create dual projectiles from fighter jet wingtips
            const projectilePositions = [
                { x: planePosition - 15, name: 'left' },
                { x: planePosition + 15, name: 'right' }
            ];
            
            projectilePositions.forEach(pos => {
                const projectile = document.createElement('div');
                projectile.className = 'projectile';
                projectile.style.left = `${pos.x}px`;
                projectile.style.bottom = '140px';
                projectile.style.background = 'linear-gradient(0deg, #ffff00, #ff8800)';
                projectile.style.boxShadow = '0 0 8px #ffff00';
                
                sky.appendChild(projectile);
                
                // Remove projectile after animation
                setTimeout(() => {
                    if (projectile.parentNode) {
                        projectile.parentNode.removeChild(projectile);
                    }
                }, 2000);
            });
            
            projectileCount++;
            
            console.log(`üöÄ Dual projectiles fired #${projectileCount} from fighter jet`);
            
            // Update score
            score += 15; // Higher score for fighter jet
            scoreElement.textContent = `Score: ${score} | Missiles: ${projectileCount}`;
            
            // Add muzzle flash effect at fighter jet nose
            const muzzleFlash = document.createElement('div');
            muzzleFlash.style.cssText = `
                position: absolute;
                left: ${planePosition - 10}px;
                bottom: 125px;
                width: 20px; height: 20px;
                background: radial-gradient(circle, #ffffff, #ffff00, transparent);
                border-radius: 50%;
                z-index: 15;
                animation: flicker 0.1s 3 alternate;
            `;
            
            sky.appendChild(muzzleFlash);
            setTimeout(() => {
                if (muzzleFlash.parentNode) {
                    muzzleFlash.parentNode.removeChild(muzzleFlash);
                }
            }, 300);
            
            // Add sound effect simulation
            console.log('üîä *RATATATATA* - Fighter jet cannon fired!');
        }

        // Connection status
        socket.on('connect', () => {
            console.log('‚úàÔ∏è Avion connect√© au contr√¥le');
        });

        socket.on('disconnect', () => {
            console.log('üö´ Avion d√©connect√© du contr√¥le');
        });
    </script>
</body>
</html>